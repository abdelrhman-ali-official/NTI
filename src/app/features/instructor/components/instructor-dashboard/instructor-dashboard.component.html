<div class="dashboard-wrapper">
  <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar-container">
      <div class="navbar-brand" (click)="goToLogo()" style="cursor: pointer;">
        <img src="assets/images/logo.png" alt="NTI Logo" class="logo">
      </div>
      <div class="navbar-menu">
        <button class="nav-link" [class.active]="activeTab === 'sessions'" (click)="activeTab = 'sessions'">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
          </svg>
          Sessions
        </button>
        <button class="nav-link" [class.active]="activeTab === 'students'" (click)="activeTab = 'students'">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
          </svg>
          Students
        </button>
        <button class="nav-link" [class.active]="activeTab === 'historical'" (click)="activeTab = 'historical'">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/>
          </svg>
          Historical
        </button>
      </div>
      <div class="navbar-actions">
        <div class="profile-dropdown" [class.open]="profileMenuOpen">
          <button class="btn-icon" (click)="toggleProfileMenu($event)" title="Profile">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
            </svg>
          </button>
          <div class="dropdown-menu" *ngIf="profileMenuOpen">
            <button class="dropdown-item" (click)="openChangePassword()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4H12.65zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/>
              </svg>
              Change Password
            </button>
            <div class="dropdown-divider"></div>
            <button class="dropdown-item danger" (click)="logout()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
              </svg>
              Logout
            </button>
          </div>
        </div>
        <button class="hamburger-btn" (click)="toggleMobileMenu()" title="Menu">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </button>
      </div>
    </div>
  </nav>

  <!-- Sidebar Overlay -->
  <div class="sidebar-overlay" *ngIf="mobileMenuOpen" (click)="toggleMobileMenu()"></div>
  
  <!-- Mobile Sidebar -->
  <div class="navbar-sidebar" [class.open]="mobileMenuOpen">
    <div class="sidebar-header">
      <div class="sidebar-greeting">
        <h3>Hi, {{ firstName }}</h3>
      </div>
      <button class="close-sidebar" (click)="toggleMobileMenu()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
    </div>
    <nav class="sidebar-menu">
      <button class="sidebar-item" [class.active]="activeTab === 'sessions'" (click)="activeTab = 'sessions'; toggleMobileMenu()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
        </svg>
        Sessions
      </button>
      <button class="sidebar-item" [class.active]="activeTab === 'students'" (click)="activeTab = 'students'; toggleMobileMenu()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
        </svg>
        Students
      </button>
      <button class="sidebar-item" [class.active]="activeTab === 'historical'" (click)="activeTab = 'historical'; toggleMobileMenu()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/>
        </svg>
        Historical
      </button>
      <div class="sidebar-divider"></div>
      <button class="sidebar-item" (click)="openChangePassword(); toggleMobileMenu()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12.65 10C11.83 7.67 9.61 6 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6c2.61 0 4.83-1.67 5.65-4H17v4h4v-4h2v-4H12.65zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/>
        </svg>
        Change Password
      </button>
      <button class="sidebar-item danger" (click)="logout()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
        </svg>
        Logout
      </button>
    </nav>
  </div>

  <!-- Sessions Section -->
  <div class="dashboard-container" *ngIf="activeTab === 'sessions'">
    <div class="dashboard-header">
      <div class="header-content">
        <h1>My Sessions</h1>
        <p class="subtitle">Manage and track your teaching sessions</p>
      </div>
      <button class="btn btn-primary" routerLink="/instructor/sessions/new">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
        </svg>
        Create New Session
      </button>
    </div>

    <div class="loading-spinner" *ngIf="loading">
      <div class="spinner"></div>
      <p>Loading sessions...</p>
    </div>

    <div class="error-card" *ngIf="error">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
        <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
      </svg>
      <p>{{ error }}</p>
      <button class="btn btn-secondary" (click)="loadSessions()">Retry</button>
    </div>

    <div class="sessions-grid" *ngIf="!loading && !error">
      <div class="session-card" *ngFor="let session of sessions; let i = index" [style.animation-delay]="i * 0.1 + 's'">
        <div class="card-glow"></div>
        <div class="session-header">
          <div class="header-left">
            <h3>{{ session.sessionName }}</h3>
            <span class="track-badge">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 3L1 9l4 2.18v6L12 21l7-3.82v-6l2-1.09V17h2V9L12 3zm6.82 6L12 12.72 5.18 9 12 5.28 18.82 9zM17 15.99l-5 2.73-5-2.73v-3.72L12 15l5-2.73v3.72z"/>
              </svg>
              {{ session.track.name }}
            </span>
          </div>
          <span class="session-status" [ngClass]="getStatusClass(session)">
            <span class="status-dot"></span>
            {{ getSessionStatus(session) }}
          </span>
        </div>
        
        <div class="session-body">
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                </svg>
              </div>
              <div class="stat-content">
                <span class="stat-label">Date</span>
                <span class="stat-value">{{ session.sessionDate | egyptDate:'MMM dd, yyyy' }}</span>
              </div>
            </div>
            <div class="stat-item">
              <div class="stat-icon">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
                </svg>
              </div>
              <div class="stat-content">
                <span class="stat-label">Time</span>
                <span class="stat-value">{{ session.sessionDate | egyptDate:'shortTime' }}</span>
              </div>
            </div>
          </div>

          <div class="attendance-summary">
            <div class="attendance-item">
              <span class="attendance-icon check-in">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg>
              </span>
              <span class="attendance-label">Check-ins</span>
              <span class="attendance-value">{{ session.totalCheckIns }}</span>
            </div>
            <div class="attendance-item">
              <span class="attendance-icon check-out">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg>
              </span>
              <span class="attendance-label">Check-outs</span>
              <span class="attendance-value">{{ session.totalCheckOuts }}</span>
            </div>
          </div>
        </div>

        <div class="session-actions">
          <button 
            class="btn btn-primary" 
            [routerLink]="['/instructor/sessions', session.id]">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
            </svg>
            Manage
          </button>
          <button 
            class="btn btn-secondary btn-attendance" 
            (click)="viewAttendance(session)">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
            </svg>
            Attendance
          </button>
          <button 
            class="btn btn-danger btn-delete" 
            (click)="deleteSession(session.id)"
            [disabled]="deletingSessionId === session.id"
            title="Delete Session">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
            </svg>
            {{ deletingSessionId === session.id ? 'Deleting...' : 'Delete' }}
          </button>
        </div>
      </div>

      <div class="empty-state" *ngIf="sessions.length === 0">
        <div class="empty-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
          </svg>
        </div>
        <h3>No Sessions Yet</h3>
        <p>Create your first session to start tracking attendance</p>
        <button class="btn btn-primary" routerLink="/instructor/sessions/new">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
          </svg>
          Create Session
        </button>
      </div>
    </div>
  </div>

  <!-- Students Section -->
  <div class="dashboard-container" *ngIf="activeTab === 'students'">
    <div class="dashboard-header">
      <div class="header-content">
        <h1>Students Management</h1>
        <p class="subtitle">Search, approve, and manage students</p>
      </div>
    </div>

    <!-- Search Bar -->
    <div class="search-section">
      <div class="search-bar">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
        </svg>
        <input 
          type="text" 
          [(ngModel)]="searchQuery" 
          (input)="searchStudents()"
          placeholder="Search by name, national ID, or email..."
          class="search-input">
        <button class="btn-clear" *ngIf="searchQuery" (click)="clearSearch()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Pending Students -->
    <div class="pending-section" *ngIf="pendingStudents.length > 0">
      <h2>Pending Approvals ({{ pendingStudents.length }})</h2>
      <div class="students-grid">
        <div class="student-card pending" *ngFor="let student of pendingStudents">
          <div class="student-header">
            <div class="student-avatar">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
              </svg>
            </div>
            <span class="status-badge pending">Pending</span>
          </div>
          <div class="student-info">
            <h3>{{ student.fullNameEnglish }}</h3>
            <p class="arabic-name">{{ student.fullNameArabic }}</p>
            <div class="info-row">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
              </svg>
              {{ student.email }}
            </div>
            <div class="info-row">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 4H4c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h16c1.11 0 2-.9 2-2V6c0-1.1-.89-2-2-2zm0 14H4V6h16v12z"/>
              </svg>
              {{ student.nationalId }}
            </div>
            <div class="info-row">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
              </svg>
              {{ student.registeredAt | egyptDate:'MMM dd, yyyy' }}
            </div>
          </div>
          <div class="student-actions">
            <div class="form-group">
              <label>Assign Track</label>
              <select [ngModel]="getSelectedTrackId(student.id)" (ngModelChange)="setSelectedTrackId(student.id, $event)" class="form-control">
                <option [ngValue]="null">Select track</option>
                <option *ngFor="let track of tracks" [ngValue]="track.trackId">{{ track.trackName }}</option>
              </select>
            </div>
            <div class="action-buttons">
              <button 
                class="btn btn-success"
                (click)="approveStudent(student.id, true)"
                [disabled]="!getSelectedTrackId(student.id) || approvingStudent === student.id">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg>
                Approve
              </button>
              <button 
                class="btn btn-danger"
                (click)="approveStudent(student.id, false)"
                [disabled]="approvingStudent === student.id">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
                Reject
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- All Students -->
    <div class="all-students-section">
      <h2>{{ searchQuery ? 'Search Results' : 'All Students' }}</h2>
      <div class="loading-spinner" *ngIf="loadingStudents">
        <div class="spinner"></div>
        <p>Loading students...</p>
      </div>
      <div class="students-grid" *ngIf="!loadingStudents">
        <div class="student-card" *ngFor="let student of displayedStudents">
          <div class="student-header">
            <div class="student-avatar">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
              </svg>
            </div>
            <span class="status-badge approved">{{ student.status }}</span>
          </div>
          <div class="student-info">
            <h3>{{ student.fullNameEnglish }}</h3>
            <p class="arabic-name">{{ student.fullNameArabic }}</p>
            <div class="info-row">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
              </svg>
              {{ student.email }}
            </div>
            <div class="info-row">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 4H4c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h16c1.11 0 2-.9 2-2V6c0-1.1-.89-2-2-2zm0 14H4V6h16v12z"/>
              </svg>
              {{ student.nationalId }}
            </div>
          </div>
        </div>
      </div>
      <div class="empty-state" *ngIf="!loadingStudents && displayedStudents.length === 0">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
        </svg>
        <p>No students found</p>
      </div>
    </div>
  </div>

  <!-- Historical Sessions Section -->
  <div class="dashboard-container" *ngIf="activeTab === 'historical'">
    <div class="dashboard-header">
      <div class="header-content">
        <h1>Historical Sessions</h1>
        <p class="subtitle">Add sessions that occurred in the past</p>
      </div>
    </div>

    <div class="historical-form-card">
      <h2>Create Historical Session</h2>
      <form class="historical-form">
        <div class="form-row">
          <div class="form-group">
            <label>Session Title *</label>
            <input 
              type="text" 
              [(ngModel)]="historicalSession.sessionTitle"
              name="sessionTitle"
              class="form-control"
              placeholder="e.g., Introduction to Angular">
          </div>
          <div class="form-group">
            <label>Track *</label>
            <select [(ngModel)]="historicalSession.trackId" name="trackId" class="form-control">
              <option [ngValue]="null">Select track</option>
              <option *ngFor="let track of tracks" [ngValue]="track.trackId">{{ track.trackName }}</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label>Session Date *</label>
          <input 
            type="datetime-local" 
            [(ngModel)]="historicalSession.sessionDate"
            name="sessionDate"
            class="form-control">
        </div>
        <div class="form-group">
          <label>Attended Students (Last 4 Digits of National ID)</label>
          <div class="student-digits-input">
            <input 
              type="text" 
              [(ngModel)]="currentDigits"
              name="currentDigits"
              class="form-control"
              placeholder="e.g., 0318"
              maxlength="4"
              pattern="[0-9]{4}"
              (keyup.enter)="addStudentDigits()">
            <button type="button" class="btn btn-secondary" (click)="addStudentDigits()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
              </svg>
              Add
            </button>
          </div>
          <div class="chips-container" *ngIf="historicalSession.attendedStudentLastFourDigits.length > 0">
            <div class="chip" *ngFor="let digits of historicalSession.attendedStudentLastFourDigits">
              {{ digits }}
              <button type="button" (click)="removeStudentDigits(digits)">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
        <button 
          type="button" 
          class="btn btn-primary"
          (click)="createHistoricalSession()"
          [disabled]="creatingHistorical || !historicalSession.sessionTitle || !historicalSession.trackId || !historicalSession.sessionDate">
          <svg *ngIf="!creatingHistorical" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
          </svg>
          <span class="spinner" *ngIf="creatingHistorical"></span>
          {{ creatingHistorical ? 'Creating...' : 'Create Historical Session' }}
        </button>
      </form>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div class="modal-overlay" *ngIf="showPasswordModal" (click)="closePasswordModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Change Password</h2>
        <button class="btn-close" (click)="closePasswordModal()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>New Password *</label>
          <input 
            type="password" 
            [(ngModel)]="newPassword"
            class="form-control"
            placeholder="Enter new password"
            minlength="8">
          <small>Password must be at least 8 characters</small>
        </div>
        <div class="form-group">
          <label>Confirm Password *</label>
          <input 
            type="password" 
            [(ngModel)]="confirmPassword"
            class="form-control"
            placeholder="Confirm new password">
        </div>
        <div class="alert alert-error" *ngIf="passwordError">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
          </svg>
          {{ passwordError }}
        </div>
        <div class="alert alert-success" *ngIf="passwordSuccess">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
          </svg>
          {{ passwordSuccess }}
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closePasswordModal()">
          Cancel
        </button>
        <button 
          class="btn btn-primary" 
          (click)="changePassword()"
          [disabled]="changingPassword || !newPassword || !confirmPassword">
          <span class="spinner" *ngIf="changingPassword"></span>
          {{ changingPassword ? 'Changing...' : 'Change Password' }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Attendance Modal -->
<div class="modal-overlay" *ngIf="showAttendanceModal" (click)="closeAttendanceModal()">
  <div class="modal-content modal-large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
        </svg>
        Session Attendance - {{ selectedSessionName }}
      </h2>
      <button class="modal-close" (click)="closeAttendanceModal()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
    </div>
    <div class="modal-body">
      <div class="loading-spinner" *ngIf="loadingAttendance">
        <div class="spinner"></div>
        <p>Loading attendance data...</p>
      </div>

      <div class="attendance-table-container" *ngIf="!loadingAttendance">
        <div class="attendance-stats">
          <div class="stat-card">
            <div class="stat-icon check-in">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
              </svg>
            </div>
            <div class="stat-info">
              <div class="stat-label">Total Check-ins</div>
              <div class="stat-value">{{ totalCheckIns }}</div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-icon check-out">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
              </svg>
            </div>
            <div class="stat-info">
              <div class="stat-label">Total Check-outs</div>
              <div class="stat-value">{{ totalCheckOuts }}</div>
            </div>
          </div>
        </div>

        <div class="table-wrapper" *ngIf="selectedSessionAttendance.length > 0">
          <table class="attendance-table">
            <thead>
              <tr>
                <th>Student Name</th>
                <th>National ID</th>
                <th>Check-in Time</th>
                <th>Check-in Method</th>
                <th>Check-out Time</th>
                <th>Check-out Method</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let record of selectedSessionAttendance">
                <td class="student-name">{{ record.student.name }}</td>
                <td class="national-id">{{ record.student.nationalId }}</td>
                <td class="time">
                  <span *ngIf="record.checkIn">{{ formatDateTime(record.checkIn.at) }}</span>
                  <span *ngIf="!record.checkIn" class="no-data">-</span>
                </td>
                <td class="method">
                  <span *ngIf="record.checkIn" class="method-badge">{{ record.checkIn.method }}</span>
                  <span *ngIf="!record.checkIn" class="no-data">-</span>
                </td>
                <td class="time">
                  <span *ngIf="record.checkOut">{{ formatDateTime(record.checkOut.at) }}</span>
                  <span *ngIf="!record.checkOut" class="no-data">-</span>
                </td>
                <td class="method">
                  <span *ngIf="record.checkOut" class="method-badge">{{ record.checkOut.method }}</span>
                  <span *ngIf="!record.checkOut" class="no-data">-</span>
                </td>
                <td class="status">
                  <span class="status-badge" [class.completed]="record.isCheckedOut" [class.incomplete]="!record.isCheckedOut">
                    {{ record.isCheckedOut ? 'Completed' : 'Incomplete' }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="empty-state" *ngIf="selectedSessionAttendance.length === 0">
          <div class="empty-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
            </svg>
          </div>
          <h3>No Attendance Records</h3>
          <p>No students have checked in to this session yet</p>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-primary" (click)="closeAttendanceModal()">
        Close
      </button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" *ngIf="showDeleteModal" (click)="closeDeleteModal()">
  <div class="modal-container delete-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <div class="delete-icon-wrapper">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
        </svg>
      </div>
      <h2>Delete Session</h2>
      <button class="close-btn" (click)="closeDeleteModal()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
      </button>
    </div>
    <div class="modal-body">
      <div class="warning-message">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
        </svg>
        <p>Are you sure you want to delete this session?</p>
      </div>
      <div class="session-info" *ngIf="sessionToDelete">
        <div class="info-item">
          <span class="info-label">Session Name:</span>
          <span class="info-value">{{ sessionToDelete.sessionName }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Track:</span>
          <span class="info-value">{{ sessionToDelete.track.name }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Date:</span>
          <span class="info-value">{{ sessionToDelete.sessionDate | egyptDate:'MMM dd, yyyy' }}</span>
        </div>
      </div>
      <div class="alert-message">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
        </svg>
        <span>This action cannot be undone. All attendance records for this session will be permanently deleted.</span>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeDeleteModal()" [disabled]="deletingSessionId !== null">
        Cancel
      </button>
      <button class="btn btn-danger" (click)="confirmDelete()" [disabled]="deletingSessionId !== null">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
        </svg>
        {{ deletingSessionId !== null ? 'Deleting...' : 'Delete Session' }}
      </button>
    </div>
  </div>
</div>
